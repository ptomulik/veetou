PRAGMA temp_store = 2;

CREATE TEMP TABLE veetou_ko_exports(
    id INTEGER PRIMARY KEY AUTOINCREMENT
  , export_id UNSIGNED BIG INT DEFAULT (RANDOMBLOB(8))
  , export_timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL
  , export_user VARCHAR(32)
  , export_name VARCHAR(32)
);

INSERT INTO veetou_ko_exports (export_user, export_name) VALUES (NULL, NULL);

-- ROOT TABLE
.mode insert veetou_ko_exports
SELECT
    veetou_ko_exports.export_*
FROM veetou_ko_exports
WHERE veetou_ko_exports.id = 1;

-- DATA TABLES

.mode insert veetou_ko_footers
SELECT
    veetou_ko_exports.export_id, ko_footers.*
FROM ko_footers
LEFT JOIN veetou_ko_exports
WHERE veetou_ko_exports.id = 1;

.mode insert veetou_ko_headers
SELECT
    veetou_ko_exports.export_id, ko_headers.*
FROM ko_headers
LEFT JOIN veetou_ko_exports
WHERE veetou_ko_exports.id = 1;

.mode insert veetou_ko_pages
SELECT
    veetou_ko_exports.export_id, ko_pages.*
FROM ko_pages
LEFT JOIN veetou_ko_exports
WHERE veetou_ko_exports.id = 1;

.mode insert veetou_ko_preambles
SELECT
    veetou_ko_exports.export_id, ko_preambles.*
FROM ko_preambles
LEFT JOIN veetou_ko_exports
WHERE veetou_ko_exports.id = 1;

.mode insert veetou_ko_reports
SELECT
    veetou_ko_exports.export_id, ko_reports.*
FROM ko_reports
LEFT JOIN veetou_ko_exports
WHERE veetou_ko_exports.id = 1;

.mode insert veetou_ko_sheets
SELECT
    veetou_ko_exports.export_id, ko_sheets.*
FROM ko_sheets
LEFT JOIN veetou_ko_exports
WHERE veetou_ko_exports.id = 1;

.mode insert veetou_ko_tbodies
SELECT
    veetou_ko_exports.export_id, ko_tbodies.*
FROM ko_tbodies
LEFT JOIN veetou_ko_exports
WHERE veetou_ko_exports.id = 1;

.mode insert veetou_ko_trs
SELECT
    veetou_ko_exports.export_id, ko_trs.*
FROM ko_trs
LEFT JOIN veetou_ko_exports
WHERE veetou_ko_exports.id = 1;

-- JUNCTION TABLES

.mode insert veetou_ko_page_footer
SELECT
    veetou_ko_exports.export_id, ko_page_footer.*
FROM ko_page_footer
LEFT JOIN veetou_ko_exports
WHERE veetou_ko_exports.id = 1;

.mode insert veetou_ko_page_header
SELECT
    veetou_ko_exports.export_id, ko_page_header.*
FROM ko_page_header
LEFT JOIN veetou_ko_exports
WHERE veetou_ko_exports.id = 1;

.mode insert veetou_ko_page_preamble
SELECT
    veetou_ko_exports.export_id, ko_page_preamble.*
FROM ko_page_preamble
LEFT JOIN veetou_ko_exports
WHERE veetou_ko_exports.id = 1;

.mode insert veetou_ko_page_tbody
SELECT
    veetou_ko_exports.export_id, ko_page_tbody.*
FROM ko_page_tbody
LEFT JOIN veetou_ko_exports
WHERE veetou_ko_exports.id = 1;

.mode insert veetou_ko_report_sheets
SELECT
    veetou_ko_exports.export_id, ko_report_sheets.*
FROM ko_report_sheets
LEFT JOIN veetou_ko_exports
WHERE veetou_ko_exports.id = 1;

.mode insert veetou_ko_sheet_pages
SELECT
    veetou_ko_exports.export_id, ko_sheet_pages.*
FROM ko_sheet_pages
LEFT JOIN veetou_ko_exports
WHERE veetou_ko_exports.id = 1;

.mode insert veetou_ko_tbody_trs
SELECT
    veetou_ko_exports.export_id, ko_tbody_trs.*
FROM ko_tbody_trs
LEFT JOIN veetou_ko_exports
WHERE veetou_ko_exports.id = 1;


DROP TABLE veetou_ko_exports;

-- vim: set ft=sql:
